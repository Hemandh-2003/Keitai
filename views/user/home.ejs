<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keitai | Home</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="/css/search.css">
  <link rel="icon" href="/images/faibcon.jpg">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <div class="mobile-menu-toggle" id="mobileMenuToggle">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <!-- Header Section -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <a href="/">
          <img src="/images/logo1.png" alt="Keitai Logo">
        </a>
      </div>
      <ul class="nav-links">
        <li><a href="/home" class="active" data-translate="store">Store</a></li>
        <li><a href="/laptop" data-translate="laptop">Laptop</a></li>
        <li><a href="/tablet" data-translate="tablet">Tablet</a></li>
        <li><a href="/phone" data-translate="phone">Phone</a></li>
        <li><a href="/watch" data-translate="watch">Watch</a></li>
        <li><a href="/earpods" data-translate="earpods">EarPods</a></li>
        <li><a href="/accessories" data-translate="accessories">Accessories</a></li>
      </ul>
      <div class="nav-icons">
        <div class="search-container mobile-search">
          <input type="text" id="search-input" placeholder="Search for products...">
          <div id="search-results"></div>
        </div>
        <select id="language-selector">
          <option value="en">English</option>
          <option value="hi">हिंदी</option>
          <option value="ml">മലയാളം</option>
          <option value="kn">ಕನ್ನಡ</option>
          <option value="te">తెలుగు</option>
        </select>
        <a href="/cart"><i class="fas fa-shopping-cart"></i></a>
        <a href="/user/profile"><i class="fas fa-user"></i></a>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    <section class="hero">
      <h1 data-translate="welcome"><span class="blue-text">Keitai.</span>The best place to start your shopping</h1>
      <div class="category-list">
        <div class="category-item">
          <a href="/laptop"><img src="/images/laptop logo.png" alt="Laptop"></a>
          <p data-translate="laptop">Laptop</p>
        </div>
        <div class="category-item">
          <a href="/tablet"><img src="/images/tablet.png" alt="Tablet"></a>
          <p data-translate="tablet">Tablet</p>
        </div>
        <div class="category-item">
          <a href="/phone"><img src="/images/phone.png" alt="Phone"></a>
          <p data-translate="phone">Phone</p>
        </div>
        <div class="category-item">
          <a href="/watch"><img src="/images/watch.png" alt="Watch"></a>
          <p data-translate="watch">Watch</p>
        </div>
        <div class="category-item">
          <a href="/earpods"><img src="/images/earpods.png" alt="EarPods"></a>
          <p data-translate="earpods">EarPods</p>
        </div>
        <div class="category-item">
          <a href="/accessories"><img src="/images/accessories.png" alt="Accessories"></a>
          <p data-translate="accessories">Accessories</p>
        </div>
        <!--div class="brand-item">
          <img src="/images/samsung.png" alt="Samsung">
        </div>
        <div class="brand-item">
          <img src="/images/apple.png" alt="Apple">
        </div-->
      </div>
    </section>
    <section class="filter-section">
      <!-- Filter Toggle Button -->
      <button class="filter-toggle-btn" id="filter-toggle-btn">
        <img src="images/filter.png" alt="Filter Icon"> Filter
      </button>

      <!-- Filter Sidebar (Initially Hidden) -->
      <aside class="filter-sidebar" id="filter-sidebar">
        <h3>Filter By</h3>
        <form action="/<%= category.slug %>" method="get" id="filter-form">
          <!-- Sort Filter -->
          <div class="filter-group">
            <h4>Sort By</h4>
            <select name="sort" onchange="this.form.submit()">
              <option value="">Select Sort Order</option>
              <option value="price-asc" <%=query && query.sort==='price-asc' ? 'selected' : '' %>
                >Price: Low to High</option>
              <option value="price-desc" <%=query && query.sort==='price-desc' ? 'selected' : '' %>
                >Price: High to Low</option>
              <option value="name-asc" <%=query && query.sort==='name-asc' ? 'selected' : '' %>>Name:
                A to Z</option>
              <option value="name-desc" <%=query && query.sort==='name-desc' ? 'selected' : '' %>
                >Name: Z to A</option>
            </select>
          </div>

          <!-- Brand Filter -->
          <div class="filter-group">
            <h4>Brand</h4>
            <label><input type="checkbox" name="brand" value="Apple" <%=query.brand==='Apple' ? 'checked' : '' %>>
              Apple</label><br>
            <label><input type="checkbox" name="brand" value="Samsung" <%=query.brand==='Samsung' ? 'checked' : '' %>>
              Samsung</label>
          </div>

          <!-- Price Filter -->
          <div class="filter-group">
            <h4>Price</h4>
            <label><input type="radio" name="price" value="below-50000" <%=query.price==='below-50000' ? 'checked' : ''
                %>> Below ₹50,000</label><br>
            <label><input type="radio" name="price" value="50000-100000" <%=query.price==='50000-100000' ? 'checked'
                : '' %>> ₹50,000 - ₹1,00,000</label><br>
            <label><input type="radio" name="price" value="above-100000" <%=query.price==='above-100000' ? 'checked'
                : '' %>> Above ₹1,00,000</label>
          </div>

          <!-- Apply and Clear Buttons -->
          <button type="submit">Apply Filters</button>
          <button type="button" onclick="clearFilters()">Clear Filters</button>
        </form>

      </aside>
    </section>
    <!-- Best Offers Section -->
    <section class="categories col-lg-12">
      <h2><span class="blue-text">Featured Products.</span> Check out our latest items.</h2>
      <div class="row">
        <% products.forEach(product=> { %>
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <a href="<%= product.isBlocked ? '#' : '/admin/products/' + product._id %>" style="text-decoration: none; color: inherit; 
                      <%= product.isBlocked ? 'pointer-events: none; cursor: not-allowed;' : '' %>">
              <div class="product-card text-center <%= product.isBlocked ? 'blocked-product' : '' %>">
                <!-- Heart Icon for Wishlist -->
          <div class="action-icons">
  <% if (!product.isBlocked) { %>
  <div class="cart-container">
    <button class="cart-icon"
      onclick="addToCart('<%= product._id %>', event)">
      <i class="fas fa-cart-plus"></i>
    </button>
  </div>
  <% } %>
  <div class="wishlist-container">
    <button class="wishlist-icon"
      onclick="addToWishlist('<%= product._id %>', this, event)">
      <i class="fas fa-heart"></i>
    </button>
  </div>
</div>





                <img src="/uploads/<%= product.images[0] %>" alt="<%= product.name %>" class="img-fluid">
                <p class="mt-2">
                  <%= product.name %>
                </p>
                <p>
                  <p>
  <% 
  // Calculate the final price to display
  var finalPrice = product.salesPrice || product.regularPrice;
  var originalPrice = product.regularPrice;
  var showDiscount = false;
  
  // Check for offer price if available
  if (typeof product.offerDetails !== 'undefined' && product.offerDetails && product.offerDetails.hasOffer) {
    finalPrice = product.offerDetails.price;
    originalPrice = product.offerDetails.originalPrice;
    showDiscount = true;
  }
  // Or check for sale price
  else if (product.salesPrice) {
    showDiscount = true;
  }
  %>
  
  <!-- Display current price -->
  <span class="current-price">₹<%= finalPrice.toLocaleString('en-IN') %></span>
  
  <% if (showDiscount) { %>
    <span class="original-price" style="text-decoration: line-through; color: #999; margin-left: 5px;">
      ₹<%= originalPrice.toLocaleString('en-IN') %>
    </span>
    <% 
    // Calculate discount percentage
    var discountPercent = Math.round((originalPrice - finalPrice) / originalPrice * 100);
    if (discountPercent > 0) { %>
      <span class="discount-badge" style="background: #ff6b6b; color: white; padding: 2px 5px; border-radius: 3px; font-size: 12px; margin-left: 5px;">
        <%= discountPercent %>% OFF
      </span>
    <% } %>
  <% } %>
</p>

                <% if (product.isBlocked) { %>
                  <p class="text-danger"> Currently Unavailable</p>
                  <% } %>
              </div>
            </a>
          </div>
          <% }); %>
      </div>
    </section>
  </main>

  <!-- Footer Section -->
  <footer>
    <div class="footer-links d-flex flex-wrap justify-content-center gap-4 mb-3">
     <a href="/user/aboutus" class="text-white text-decoration-none" data-translate="about">About</a>
      <a href="/user/services" class="text-white text-decoration-none" data-translate="services">Services</a>
      <a href="/user/support" class="text-white text-decoration-none" data-translate="support">Support</a>
      <a href="/user/contact" class="text-white text-decoration-none" data-translate="contact">Contact Us</a>
    </div>
    <div class="social-icons">
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-linkedin"></i></a>
    </div>
    <p>&copy; 2024 Keitai. All rights reserved.</p>
  </footer>
  <script>document.getElementById('language-selector').addEventListener('change', function () {
      const selectedLanguage = this.value;
      loadLanguage(selectedLanguage);
    });

    function loadLanguage(lang) {
      fetch(`/js/${lang}.json`)
        .then(response => response.json())
        .then(data => {
          translatePage(data);
          localStorage.setItem('preferredLanguage', lang); // Store preference
        })
        .catch(error => console.error('Error loading language file:', error));
    }

    function translatePage(translations) {
      document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[key]) {
          element.textContent = translations[key];
        }
      });
    }

    // Load default language on page load
    document.addEventListener('DOMContentLoaded', () => {
      const preferredLanguage = localStorage.getItem('preferredLanguage') || 'en';
      document.getElementById('language-selector').value = preferredLanguage;
      loadLanguage(preferredLanguage);
    });</script>
  <script src="/js/search.js"></script>
  <script src="/js/home.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeo1zE63F5oY6pD8Cqh1zFHmZxEFSfoN3jD9RVBl+zR8KSk" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeo1zE63F5oY6pD8Cqh1zFHmZxEFSfoN3jD9RVBl+zR8KSk" crossorigin="anonymous"></script>
  <script>
    // Helper function to build pagination URLs with existing query parameters
    function buildPaginationUrl(queryParams, page) {
      const params = new URLSearchParams();

      // Add existing query parameters
      if (queryParams.search) params.append('search', queryParams.search);
      if (queryParams.category) params.append('category', queryParams.category);
      if (queryParams.sort) params.append('sort', queryParams.sort);

      // Add page parameter
      params.append('page', page);

      return window.location.pathname + '?' + params.toString();
    }
  </script>
   <script src="/js/page.js"></script>
    <script src="/js/search.js"></script>
     <script>
  function addToCart(productId, event) {
    event.preventDefault();

    fetch('/cart/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ productId, quantity: 1 })
    })
    .then(res => res.json())
    .then(data => {
      console.log('Cart response:', data);

      if (data.success) {
        Swal.fire({
          icon: 'success',
          title: 'Added to cart!',
          showConfirmButton: false,
          timer: 1200
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Failed to add to cart',
          text: data.message || data.error || 'Please try again.'
        });
      }
    })
    .catch(error => {
      console.error('Cart Error:', error);
      Swal.fire('Error', 'Could not add to cart.', 'error');
    });
  }
</script>
</body>

</html>